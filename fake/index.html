<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Travaux Routiers Antananarivo - Suivi en temps réel</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <i class="fas fa-road"></i>
                <span>TravauxTana</span>
            </div>
            <nav class="nav-menu">
                <a href="#" class="nav-link active" data-page="map"><i class="fas fa-map-marked-alt"></i> Carte</a>
                <a href="#" class="nav-link" data-page="dashboard"><i class="fas fa-chart-bar"></i> Tableau de bord</a>
            </nav>
            <div class="user-actions">
                <button class="btn btn-outline" id="btnLogin"><i class="fas fa-sign-in-alt"></i> Connexion</button>
                <button class="btn btn-primary" id="btnRegister"><i class="fas fa-user-plus"></i> Inscription</button>
            </div>
            <!-- Menu utilisateur connecté (caché par défaut) -->
            <div class="user-menu hidden" id="userMenu">
                <div class="user-info">
                    <div class="user-avatar"><i class="fas fa-user"></i></div>
                    <span class="user-name" id="userName">Utilisateur</span>
                    <span class="user-role" id="userRole">Visiteur</span>
                </div>
                <button class="btn btn-outline btn-sm" id="btnLogout"><i class="fas fa-sign-out-alt"></i> Déconnexion</button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Page Carte -->
        <section class="page active" id="pageCarte">
            <div class="map-container">
                <div id="map"></div>

                <!-- Filtres utilisateur -->
                <div class="map-filters hidden" id="userFilters">
                    <label class="filter-checkbox">
                        <input type="checkbox" id="filterMyReports">
                        <span>Afficher uniquement mes signalements</span>
                    </label>
                </div>

                <!-- Bouton d'ajout de signalement -->
                <button class="fab-button hidden" id="btnAddReport" title="Signaler un problème">
                    <i class="fas fa-plus"></i>
                </button>

                <!-- Panneau de récapitulation -->
                <div class="stats-panel">
                    <h3><i class="fas fa-chart-pie"></i> Récapitulatif</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <span class="stat-value" id="statPoints">12</span>
                            <span class="stat-label">Points signalés</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" id="statSurface">2,450 m²</span>
                            <span class="stat-label">Surface totale</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" id="statProgress">58%</span>
                            <span class="stat-label">Avancement</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" id="statBudget">125M Ar</span>
                            <span class="stat-label">Budget total</span>
                        </div>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="progressBar" style="width: 58%"></div>
                    </div>
                </div>

                <!-- Légende -->
                <div class="map-legend">
                    <h4>Légende</h4>
                    <div class="legend-item">
                        <span class="legend-marker new"></span>
                        <span>Nouveau</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-marker in-progress"></span>
                        <span>En cours</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-marker completed"></span>
                        <span>Terminé</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Page Tableau de bord -->
        <section class="page" id="pageDashboard">
            <div class="dashboard-container">
                <h2><i class="fas fa-tachometer-alt"></i> Tableau de bord</h2>

                <div class="dashboard-stats">
                    <div class="dashboard-card">
                        <div class="card-icon new"><i class="fas fa-exclamation-circle"></i></div>
                        <div class="card-content">
                            <span class="card-value">4</span>
                            <span class="card-label">Nouveaux signalements</span>
                        </div>
                    </div>
                    <div class="dashboard-card">
                        <div class="card-icon in-progress"><i class="fas fa-hard-hat"></i></div>
                        <div class="card-content">
                            <span class="card-value">5</span>
                            <span class="card-label">En cours de travaux</span>
                        </div>
                    </div>
                    <div class="dashboard-card">
                        <div class="card-icon completed"><i class="fas fa-check-circle"></i></div>
                        <div class="card-content">
                            <span class="card-value">3</span>
                            <span class="card-label">Travaux terminés</span>
                        </div>
                    </div>
                    <div class="dashboard-card">
                        <div class="card-icon budget"><i class="fas fa-money-bill-wave"></i></div>
                        <div class="card-content">
                            <span class="card-value">125M Ar</span>
                            <span class="card-label">Budget total alloué</span>
                        </div>
                    </div>
                </div>

                <!-- Tableau des signalements -->
                <div class="table-container">
                    <div class="table-header">
                        <h3>Liste des signalements</h3>
                        <div class="table-actions">
                            <input type="text" class="search-input" placeholder="Rechercher..." id="searchInput">
                            <select class="filter-select" id="statusFilter">
                                <option value="">Tous les statuts</option>
                                <option value="nouveau">Nouveau</option>
                                <option value="en_cours">En cours</option>
                                <option value="termine">Terminé</option>
                            </select>
                        </div>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Localisation</th>
                                <th>Date</th>
                                <th>Statut</th>
                                <th>Surface</th>
                                <th>Budget</th>
                                <th>Entreprise</th>
                            </tr>
                        </thead>
                        <tbody id="reportsTableBody">
                            <!-- Données générées par JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Page Manager -->
        <section class="page" id="pageManager">
            <div class="manager-container">
                <div class="manager-header">
                    <h2><i class="fas fa-cogs"></i> Panneau d'administration</h2>
                    <button class="btn btn-primary" id="btnSync">
                        <i class="fas fa-sync-alt"></i> Synchroniser
                    </button>
                </div>

                <div class="manager-tabs">
                    <button class="tab-btn active" data-tab="signalements"><i class="fas fa-map-marker-alt"></i> Signalements</button>
                    <button class="tab-btn" data-tab="utilisateurs"><i class="fas fa-users"></i> Utilisateurs</button>
                    <button class="tab-btn" data-tab="comptes"><i class="fas fa-user-plus"></i> Créer un compte</button>
                </div>

                <!-- Tab Signalements -->
                <div class="tab-content active" id="tabSignalements">
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Localisation</th>
                                    <th>Date</th>
                                    <th>Statut</th>
                                    <th>Surface (m²)</th>
                                    <th>Budget (Ar)</th>
                                    <th>Entreprise</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="managerReportsTable">
                                <!-- Données générées par JS -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Tab Utilisateurs -->
                <div class="tab-content" id="tabUtilisateurs">
                    <div class="table-container">
                        <h3>Gestion des utilisateurs bloqués</h3>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nom</th>
                                    <th>Email</th>
                                    <th>Date inscription</th>
                                    <th>Statut</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="usersTable">
                                <!-- Données générées par JS -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Tab Créer compte -->
                <div class="tab-content" id="tabComptes">
                    <div class="form-container">
                        <h3>Créer un nouveau compte utilisateur</h3>
                        <form id="createUserForm">
                            <div class="form-group">
                                <label for="newUserName">Nom complet</label>
                                <input type="text" id="newUserName" required>
                            </div>
                            <div class="form-group">
                                <label for="newUserEmail">Email</label>
                                <input type="email" id="newUserEmail" required>
                            </div>
                            <div class="form-group">
                                <label for="newUserPassword">Mot de passe</label>
                                <input type="password" id="newUserPassword" required>
                            </div>
                            <div class="form-group">
                                <label for="newUserRole">Rôle</label>
                                <select id="newUserRole">
                                    <option value="utilisateur">Utilisateur</option>
                                    <option value="manager">Manager</option>
                                </select>
                            </div>
                            <button type="submit" class="btn btn-primary btn-block">
                                <i class="fas fa-user-plus"></i> Créer le compte
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Modal Login -->
    <div class="modal" id="modalLogin">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-sign-in-alt"></i> Connexion</h3>
                <button class="modal-close" data-close="modalLogin">&times;</button>
            </div>
            <form id="loginForm">
                <div class="form-group">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" placeholder="votre@email.com" required>
                </div>
                <div class="form-group">
                    <label for="loginPassword">Mot de passe</label>
                    <input type="password" id="loginPassword" placeholder="••••••••" required>
                </div>
                <button type="submit" class="btn btn-primary btn-block">Se connecter</button>
            </form>
            <div class="modal-footer">
                <p>Pas encore de compte ? <a href="#" id="linkToRegister">Contactez un manager</a></p>
            </div>
        </div>
    </div>

    <!-- Modal Register (Manager uniquement) -->
    <div class="modal" id="modalRegister">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-user-plus"></i> Inscription Manager</h3>
                <button class="modal-close" data-close="modalRegister">&times;</button>
            </div>
            <form id="registerForm">
                <div class="form-group">
                    <label for="registerName">Nom complet</label>
                    <input type="text" id="registerName" placeholder="Jean Rakoto" required>
                </div>
                <div class="form-group">
                    <label for="registerEmail">Email</label>
                    <input type="email" id="registerEmail" placeholder="votre@email.com" required>
                </div>
                <div class="form-group">
                    <label for="registerPassword">Mot de passe</label>
                    <input type="password" id="registerPassword" placeholder="••••••••" required>
                </div>
                <div class="form-group">
                    <label for="registerPasswordConfirm">Confirmer le mot de passe</label>
                    <input type="password" id="registerPasswordConfirm" placeholder="••••••••" required>
                </div>
                <button type="submit" class="btn btn-primary btn-block">Créer mon compte Manager</button>
            </form>
        </div>
    </div>

    <!-- Modal Signalement -->
    <div class="modal" id="modalReport">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3><i class="fas fa-exclamation-triangle"></i> Nouveau signalement</h3>
                <button class="modal-close" data-close="modalReport">&times;</button>
            </div>
            <form id="reportForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="reportLat">Latitude</label>
                        <input type="text" id="reportLat" readonly>
                    </div>
                    <div class="form-group">
                        <label for="reportLng">Longitude</label>
                        <input type="text" id="reportLng" readonly>
                    </div>
                </div>
                <div class="form-group">
                    <label for="reportAddress">Adresse / Localisation</label>
                    <input type="text" id="reportAddress" placeholder="Ex: Avenue de l'Indépendance" required>
                </div>
                <div class="form-group">
                    <label for="reportDescription">Description du problème</label>
                    <textarea id="reportDescription" rows="3" placeholder="Décrivez le problème routier..." required></textarea>
                </div>
                <div class="form-group">
                    <label for="reportType">Type de problème</label>
                    <select id="reportType" required>
                        <option value="">Sélectionner...</option>
                        <option value="nid_poule">Nid de poule</option>
                        <option value="fissure">Fissure</option>
                        <option value="effondrement">Effondrement</option>
                        <option value="inondation">Zone inondable</option>
                        <option value="autre">Autre</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Photo (optionnel)</label>
                    <div class="file-upload">
                        <input type="file" id="reportPhoto" accept="image/*">
                        <div class="file-upload-label">
                            <i class="fas fa-camera"></i>
                            <span>Cliquez ou déposez une photo</span>
                        </div>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary btn-block">
                    <i class="fas fa-paper-plane"></i> Envoyer le signalement
                </button>
            </form>
        </div>
    </div>

    <!-- Modal Edit Signalement (Manager) -->
    <div class="modal" id="modalEditReport">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> Modifier le signalement</h3>
                <button class="modal-close" data-close="modalEditReport">&times;</button>
            </div>
            <form id="editReportForm">
                <input type="hidden" id="editReportId">
                <div class="form-group">
                    <label for="editReportAddress">Localisation</label>
                    <input type="text" id="editReportAddress" required>
                </div>
                <div class="form-group">
                    <label for="editReportStatus">Statut</label>
                    <select id="editReportStatus" required>
                        <option value="nouveau">Nouveau</option>
                        <option value="en_cours">En cours</option>
                        <option value="termine">Terminé</option>
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="editReportSurface">Surface (m²)</label>
                        <input type="number" id="editReportSurface" min="0" step="0.1">
                    </div>
                    <div class="form-group">
                        <label for="editReportBudget">Budget (Ariary)</label>
                        <input type="number" id="editReportBudget" min="0">
                    </div>
                </div>
                <div class="form-group">
                    <label for="editReportCompany">Entreprise assignée</label>
                    <select id="editReportCompany">
                        <option value="">Non assignée</option>
                        <option value="COLAS Madagascar">COLAS Madagascar</option>
                        <option value="SOGEA SATOM">SOGEA SATOM</option>
                        <option value="ENTREPRISE RAZAFY">ENTREPRISE RAZAFY</option>
                        <option value="TRAVAUX PUBLICS MADA">TRAVAUX PUBLICS MADA</option>
                        <option value="BTP CONSTRUCTION">BTP CONSTRUCTION</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editReportNotes">Notes internes</label>
                    <textarea id="editReportNotes" rows="3" placeholder="Notes pour le suivi..."></textarea>
                </div>
                <button type="submit" class="btn btn-primary btn-block">
                    <i class="fas fa-save"></i> Enregistrer les modifications
                </button>
            </form>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container" id="toastContainer"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="js/data.js"></script>
    <script src="js/app.js"></script>
</body>
</html>

